<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Versz</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>

@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap');

:root {
    /* Color Palette */
    --bg-color: #0f172a;
    --sidebar-bg: #1e293b;
    --card-bg: rgba(30, 41, 59, 0.5);
    --text-primary: #f8fafc;
    --text-secondary: #94a3b8;
    --accent-color: #3b82f6;
    --hover-bg: rgba(59, 130, 246, 0.1);
    --border-color: rgba(148, 163, 184, 0.1);
    --error-color: #ef4444;
    --success-color: #10b981;

    /* Layout */
    --sidebar-width: 280px;
    --sidebar-width-mobile: 70px;
    --card-border-radius: 16px;
    --input-border-radius: 12px;
    
    /* Animation */
    --transition-speed: 0.3s;
    
    /* Shadows */
    --box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
                  0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --hover-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
                    0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Plus Jakarta Sans', sans-serif;
}

body {
    background: var(--bg-color);
    color: var(--text-primary);
    min-height: 100vh;
    display: flex;
    line-height: 1.6;
    font-size: 16px;
}

/* Scrollbar Styling */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: var(--sidebar-bg);
}

::-webkit-scrollbar-thumb {
    background: var(--text-secondary);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--accent-color);
}

/* Base Layout */
.main-content {
    margin-left: var(--sidebar-width);
    padding: 2rem;
    width: calc(100% - var(--sidebar-width));
    min-height: 100vh;
    transition: all var(--transition-speed) ease;
}

.content-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
}

@media (max-width: 768px) {
    .main-content {
        margin-left: var(--sidebar-width-mobile);
        width: calc(100% - var(--sidebar-width-mobile));
        padding: 1rem;
    }
    
    .content-container {
        padding: 0 0.5rem;
    }
}

.sidebar {
    width: var(--sidebar-width);
    background: var(--sidebar-bg);
    padding: 2rem 1.5rem;
    display: flex;
    flex-direction: column;
    position: fixed;
    height: 100vh;
    border-right: 1px solid var(--border-color);
    transition: all var(--transition-speed) ease;
    z-index: 1000;
    box-shadow: var(--box-shadow);
    overflow-y: auto;
    overflow-x: hidden;
}

/* Logo Styles */
.logo {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 2.5rem;
    color: var(--text-primary);
    text-decoration: none;
    font-size: 1.5rem;
    font-weight: 700;
    padding: 0.5rem;
    border-radius: var(--input-border-radius);
    transition: all var(--transition-speed) ease;
}

.logo:hover {
    background: var(--hover-bg);
    transform: translateX(5px);
}

.logo img {
    width: 40px;
    height: 40px;
    border-radius: 12px;
    object-fit: cover;
}

/* Navigation Items */
.nav-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    color: var(--text-secondary);
    text-decoration: none;
    border-radius: var(--input-border-radius);
    margin-bottom: 0.5rem;
    transition: all var(--transition-speed) ease;
    cursor: pointer;
    font-weight: 500;
    position: relative;
}

.nav-item:hover,
.nav-item.active {
    background: var(--hover-bg);
    color: var(--accent-color);
    transform: translateX(5px);
}

.nav-item i {
    width: 24px;
    text-align: center;
    font-size: 1.2rem;
}

.nav-item span {
    font-size: 0.95rem;
}

/* Navigation Groups */
#auth-nav,
#app-nav {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

/* Mobile Sidebar Adjustments */
@media (max-width: 768px) {
    .sidebar {
        width: var(--sidebar-width-mobile);
        padding: 1.5rem 0.75rem;
    }

    .logo span,
    .nav-item span {
        display: none;
    }

    .logo img {
        width: 32px;
        height: 32px;
    }

    .nav-item {
        justify-content: center;
        padding: 1rem;
    }

    .nav-item i {
        margin: 0;
        font-size: 1.4rem;
    }

    /* Tooltip for mobile navigation */
    .nav-item::after {
        content: attr(data-tooltip);
        position: absolute;
        left: 100%;
        top: 50%;
        transform: translateY(-50%);
        background: var(--sidebar-bg);
        padding: 0.5rem 1rem;
        border-radius: var(--input-border-radius);
        font-size: 0.85rem;
        white-space: nowrap;
        opacity: 0;
        visibility: hidden;
        transition: all var(--transition-speed) ease;
        pointer-events: none;
        box-shadow: var(--box-shadow);
        margin-left: 10px;
    }

    .nav-item:hover::after {
        opacity: 1;
        visibility: visible;
    }
}

/* Tablet Adjustments */
@media (min-width: 769px) and (max-width: 1024px) {
    .sidebar {
        width: 240px;
    }

    .logo {
        font-size: 1.25rem;
    }

    .nav-item {
        padding: 0.875rem;
    }
}

/* Navigation Separator */
.nav-separator {
    height: 1px;
    background: var(--border-color);
    margin: 1rem 0;
    opacity: 0.5;
}
/* Card Base Styles */
.card {
    background: var(--card-bg);
    border-radius: var(--card-border-radius);
    padding: 2rem;
    margin-bottom: 1.5rem;
    backdrop-filter: blur(10px);
    border: 1px solid var(--border-color);
    box-shadow: var(--box-shadow);
    transition: all var(--transition-speed) ease;
}

.card:hover {
    box-shadow: var(--hover-shadow);
    transform: translateY(-2px);
}

.card h2 {
    font-size: 1.5rem;
    margin-bottom: 1.5rem;
    color: var(--text-primary);
    font-weight: 600;
}

/* Input Styles */
.input {
    background: var(--sidebar-bg);
    border: 1px solid var(--border-color);
    padding: 1rem 1.25rem;
    border-radius: var(--input-border-radius);
    color: var(--text-primary);
    width: 100%;
    margin-bottom: 1rem;
    transition: all var(--transition-speed) ease;
    font-size: 0.95rem;
    line-height: 1.5;
}

.input:focus {
    border-color: var(--accent-color);
    outline: none;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.input::placeholder {
    color: var(--text-secondary);
    opacity: 0.7;
}

/* Select Input Styling */
select.input {
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2394a3b8'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    background-size: 1.25rem;
    padding-right: 2.5rem;
}

/* Textarea Styling */
textarea.input {
    min-height: 120px;
    resize: vertical;
    font-family: inherit;
    line-height: 1.6;
}

/* Button Styles */
.btn {
    background: var(--accent-color);
    color: var(--text-primary);
    padding: 1rem 1.5rem;
    border-radius: var(--input-border-radius);
    border: none;
    cursor: pointer;
    transition: all var(--transition-speed) ease;
    font-weight: 600;
    font-size: 0.95rem;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    position: relative;
    overflow: hidden;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--hover-shadow);
}

.btn:active {
    transform: translateY(0);
}

.btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

/* Button Variants */
.btn-secondary {
    background: var(--sidebar-bg);
    border: 1px solid var(--border-color);
}

.btn-danger {
    background: var(--error-color);
}

.btn-success {
    background: var(--success-color);
}

/* Form Groups */
.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--text-secondary);
    font-size: 0.9rem;
    font-weight: 500;
}

.form-group .helper-text {
    font-size: 0.8rem;
    color: var(--text-secondary);
    margin-top: 0.25rem;
}

/* Form Grid Layout */
.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
}

/* Status Messages */
.error {
    color: var(--error-color);
    margin-top: 0.75rem;
    font-size: 0.9rem;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.success {
    color: var(--success-color);
    margin-top: 0.75rem;
    font-size: 0.9rem;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

/* Loading States */
.loading {
    display: none;
    margin: 1rem 0;
}

.loading.active {
    display: flex;
    align-items: center;
    justify-content: center;
}

.spinner {
    width: 30px;
    height: 30px;
    border: 3px solid var(--text-secondary);
    border-top: 3px solid var(--accent-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Mobile Responsiveness */
@media (max-width: 768px) {
    .card {
        padding: 1.5rem;
        margin-bottom: 1rem;
    }

    .input, 
    .btn {
        padding: 0.875rem 1rem;
    }

    .form-grid {
        grid-template-columns: 1fr;
    }
}
/* Overlay Base */
.overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(15, 23, 42, 0.8);
    z-index: 1999;
    display: none;
    backdrop-filter: blur(4px);
}

.overlay.active {
    display: block;
}

/* Modal Base */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 2000;
    align-items: center;
    justify-content: center;
    padding: 1rem;
}

.modal.active {
    display: flex;
}

.modal-content {
    background: var(--sidebar-bg);
    padding: 2rem;
    border-radius: var(--card-border-radius);
    max-width: 500px;
    width: 100%;
    border: 1px solid var(--border-color);
    box-shadow: var(--box-shadow);
    position: relative;
    animation: modalSlideIn 0.3s ease;
}

@keyframes modalSlideIn {
    from {
        transform: translateY(-20px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

/* Modal Header */
.modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1.5rem;
}

.modal-header h2 {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
}

/* Modal Close Button */
.close-button {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    font-size: 1.5rem;
    padding: 0.5rem;
    transition: all var(--transition-speed) ease;
    border-radius: 50%;
}

.close-button:hover {
    color: var(--text-primary);
    transform: rotate(90deg);
    background: var(--hover-bg);
}

/* Modal Actions */
.modal-actions {
    display: flex;
    gap: 1rem;
    margin-top: 1.5rem;
}

.modal-actions .btn {
    flex: 1;
}

/* File Management */
.file-list {
    display: grid;
    gap: 1rem;
}

.file-item {
    background: var(--card-bg);
    border-radius: var(--card-border-radius);
    padding: 1.5rem;
    border: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1.5rem;
    transition: all var(--transition-speed) ease;
}

.file-item:hover {
    transform: translateY(-2px);
    box-shadow: var(--hover-shadow);
    border-color: var(--accent-color);
}

.file-info {
    flex: 1;
    min-width: 0;
    overflow: hidden;
}

.file-name {
    font-weight: 600;
    font-size: 1.1rem;
    margin-bottom: 8px;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.file-url {
    word-break: break-all;
    overflow-wrap: break-word;
    max-width: 100%;
    margin: 8px 0;
    font-size: 0.9rem;
}

.file-url a {
    color: var(--accent-color);
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    transition: all var(--transition-speed) ease;
}

.file-url a:hover {
    opacity: 0.8;
    text-decoration: underline;
}

.file-meta,
.file-stats,
.file-dates {
    color: var(--text-secondary);
    font-size: 0.85rem;
    margin-top: 0.5rem;
}

/* File Actions */
.file-actions {
    display: flex;
    gap: 0.75rem;
    flex-shrink: 0;
}

.file-action {
    background: var(--sidebar-bg);
    border: 1px solid var(--border-color);
    color: var(--text-primary);
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all var(--transition-speed) ease;
}

.file-action:hover {
    background: var(--hover-bg);
    color: var(--accent-color);
    transform: translateY(-2px);
    border-color: var(--accent-color);
}

/* Upload Section */
.upload-section {
    background: var(--card-bg);
    border-radius: var(--card-border-radius);
    padding: 2rem;
    margin-bottom: 1.5rem;
}

.file-input-container {
    border: 2px dashed var(--border-color);
    border-radius: var(--card-border-radius);
    padding: 2rem;
    text-align: center;
    margin-bottom: 1rem;
    transition: all var(--transition-speed) ease;
}

.file-input-container:hover {
    border-color: var(--accent-color);
    background: var(--hover-bg);
}

/* Mobile Responsiveness */
@media (max-width: 768px) {
    .modal-content {
        padding: 1.5rem;
    }

    .file-item {
        flex-direction: column;
        padding: 1rem;
    }

    .file-actions {
        width: 100%;
        justify-content: flex-end;
    }

    .file-action {
        width: 36px;
        height: 36px;
    }
}

/* Profile Section */
.profile-section {
    padding: 2rem;
    max-width: 100%;
    background: var(--card-bg);
    border-radius: var(--card-border-radius);
    border: 1px solid var(--border-color);
}

.profile-info {
    display: grid;
    gap: 1.5rem;
    margin: 1.5rem 0;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
}

.profile-stat {
    background: var(--sidebar-bg);
    padding: 1.5rem;
    border-radius: var(--card-border-radius);
    border: 1px solid var(--border-color);
    transition: all var(--transition-speed) ease;
}

.profile-stat:hover {
    transform: translateY(-2px);
    box-shadow: var(--hover-shadow);
    border-color: var(--accent-color);
}

.profile-stat-value {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-top: 0.5rem;
    word-break: break-all;
    overflow-wrap: break-word;
}

.profile-stat-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Preferences Section */
.preferences-section {
    margin-top: 2rem;
    padding: 2rem;
    background: var(--card-bg);
    border-radius: var(--card-border-radius);
    border: 1px solid var(--border-color);
}

.preferences-section h3 {
    margin-bottom: 1.5rem;
    font-size: 1.25rem;
    color: var(--text-primary);
}

.preference-toggle {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin: 1rem 0;
    padding: 1rem;
    background: var(--sidebar-bg);
    border-radius: var(--input-border-radius);
    transition: all var(--transition-speed) ease;
}

.preference-toggle:hover {
    background: var(--hover-bg);
}

/* Toggle Switch */
.toggle-switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 26px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--card-bg);
    transition: .4s;
    border-radius: 26px;
    border: 1px solid var(--border-color);
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 4px;
    bottom: 3px;
    background-color: var(--text-secondary);
    transition: .4s;
    border-radius: 50%;
}

input:checked + .toggle-slider {
    background-color: var(--accent-color);
}

input:checked + .toggle-slider:before {
    transform: translateX(24px);
    background-color: white;
}

/* Tags Container */
.tags-container {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    margin-top: 1.5rem;
}

.tag {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: var(--sidebar-bg);
    border-radius: 20px;
    font-size: 0.9rem;
    color: var(--text-secondary);
    border: 1px solid var(--border-color);
    transition: all var(--transition-speed) ease;
}

.tag:hover {
    transform: translateY(-2px);
    border-color: var(--accent-color);
    color: var(--text-primary);
}

/* Editor Sections */
.editor-sections {
    display: grid;
    gap: 2rem;
    margin: 2rem 0;
}

.editor-section {
    background: var(--card-bg);
    border-radius: var(--card-border-radius);
    padding: 1.5rem;
    border: 1px solid var(--border-color);
}

.editor-section h3 {
    margin-bottom: 1.5rem;
    color: var(--text-primary);
    font-size: 1.2rem;
    font-weight: 600;
}

/* Range Input Styling */
.range-with-value {
    display: flex;
    align-items: center;
    gap: 1rem;
    background: var(--sidebar-bg);
    padding: 0.75rem;
    border-radius: var(--input-border-radius);
}

input[type="range"] {
    -webkit-appearance: none;
    width: 100%;
    height: 6px;
    background: var(--card-bg);
    border-radius: 3px;
    outline: none;
}

input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    background: var(--accent-color);
    border-radius: 50%;
    cursor: pointer;
    transition: all var(--transition-speed) ease;
}

input[type="range"]::-webkit-slider-thumb:hover {
    transform: scale(1.1);
    box-shadow: 0 0 10px var(--accent-color);
}

.range-value {
    min-width: 48px;
    color: var(--text-secondary);
    font-size: 0.9rem;
    font-weight: 500;
}

/* Color Picker Styling */
.color-picker-wrapper {
    display: flex;
    align-items: center;
    gap: 1rem;
    background: var(--sidebar-bg);
    padding: 0.75rem;
    border-radius: var(--input-border-radius);
}

input[type="color"] {
    -webkit-appearance: none;
    width: 42px;
    height: 42px;
    border: none;
    border-radius: 8px;
    padding: 0;
    cursor: pointer;
}

input[type="color"]::-webkit-color-swatch-wrapper {
    padding: 0;
}

input[type="color"]::-webkit-color-swatch {
    border: none;
    border-radius: 8px;
}

/* Mobile Responsiveness */
@media (max-width: 768px) {
    .profile-section,
    .preferences-section {
        padding: 1rem;
    }

    .profile-info {
        grid-template-columns: 1fr;
        gap: 1rem;
    }

    .profile-stat {
        padding: 1rem;
    }

    .editor-sections {
        gap: 1rem;
    }

    .editor-section {
        padding: 1rem;
    }

    .color-picker-wrapper {
        flex-wrap: wrap;
    }
}

/* Tablet Adjustments */
@media (min-width: 769px) and (max-width: 1024px) {
    .profile-info {
        grid-template-columns: repeat(2, 1fr);
    }
}


/* Animations */
@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

@keyframes slideUp {
    from {
        transform: translateY(20px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

@keyframes pulse {
    0% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
    100% {
        transform: scale(1);
    }
}

/* Save Indicator Animation */
.save-indicator {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    padding: 1rem 2rem;
    background: var(--accent-color);
    color: var(--text-primary);
    border-radius: var(--input-border-radius);
    transform: translateY(100px);
    transition: transform 0.3s ease;
    z-index: 1000;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    box-shadow: var(--box-shadow);
}

.save-indicator.active {
    transform: translateY(0);
    animation: pulse 1.5s infinite;
}

/* Loading States and Spinners */
.loading-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(15, 23, 42, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(4px);
    border-radius: var(--card-border-radius);
    z-index: 10;
}

.spinner-large {
    width: 50px;
    height: 50px;
    border: 4px solid var(--text-secondary);
    border-top: 4px solid var(--accent-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

/* Progress Bar */
.progress-container {
    width: 100%;
    height: 4px;
    background: var(--card-bg);
    border-radius: 2px;
    overflow: hidden;
    margin: 1rem 0;
}

.progress-bar {
    height: 100%;
    background: var(--accent-color);
    transition: width 0.3s ease;
}

/* Utility Classes */
.text-primary {
    color: var(--text-primary);
}

.text-secondary {
    color: var(--text-secondary);
}

.text-accent {
    color: var(--accent-color);
}

.text-error {
    color: var(--error-color);
}

.text-success {
    color: var(--success-color);
}

.bg-hover:hover {
    background: var(--hover-bg);
}

.flex {
    display: flex;
}

.flex-center {
    display: flex;
    align-items: center;
    justify-content: center;
}

.gap-1 {
    gap: 1rem;
}

.mt-1 { margin-top: 1rem; }
.mb-1 { margin-bottom: 1rem; }
.ml-1 { margin-left: 1rem; }
.mr-1 { margin-right: 1rem; }

.p-1 { padding: 1rem; }
.py-1 { padding: 1rem 0; }
.px-1 { padding: 0 1rem; }

/* Responsive Utilities */
.hide-mobile {
    display: block;
}

.show-mobile {
    display: none;
}

/* Link Styles */
.link-text {
    color: var(--accent-color);
    cursor: pointer;
    text-decoration: none;
    transition: all var(--transition-speed) ease;
}

.link-text:hover {
    opacity: 0.8;
    text-decoration: underline;
}

/* Custom Scrollbar for Containers */
.custom-scroll {
    scrollbar-width: thin;
    scrollbar-color: var(--text-secondary) var(--sidebar-bg);
}

.custom-scroll::-webkit-scrollbar {
    width: 6px;
}

.custom-scroll::-webkit-scrollbar-track {
    background: var(--sidebar-bg);
}

.custom-scroll::-webkit-scrollbar-thumb {
    background-color: var(--text-secondary);
    border-radius: 3px;
}

/* Tooltip */
.tooltip {
    position: relative;
}

.tooltip:before {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    padding: 0.5rem 1rem;
    background: var(--sidebar-bg);
    color: var(--text-primary);
    border-radius: var(--input-border-radius);
    font-size: 0.85rem;
    white-space: nowrap;
    opacity: 0;
    visibility: hidden;
    transition: all var(--transition-speed) ease;
    z-index: 1000;
    box-shadow: var(--box-shadow);
}

.tooltip:hover:before {
    opacity: 1;
    visibility: visible;
    transform: translateX(-50%) translateY(-8px);
}
/* Verify Email Container Styles */
#verifyEmailContainer {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 2000;
    max-width: 500px;
    width: 90%;
    background: var(--sidebar-bg);
    border-radius: var(--card-border-radius);
    border: 1px solid var(--border-color);
    padding: 2rem;
    box-shadow: var(--box-shadow);
    display: none;
    animation: slideIn 0.3s ease;
}

#verifyEmailContainer.active {
    display: block;
}

@keyframes slideIn {
    from {
        transform: translate(-50%, -60%);
        opacity: 0;
    }
    to {
        transform: translate(-50%, -50%);
        opacity: 1;
    }
}
/* Responsive Adjustments */
@media (max-width: 768px) {
    .hide-mobile {
        display: none;
    }

    .show-mobile {
        display: block;
    }

    .container {
        padding: 0 1rem;
    }

    .save-indicator {
        bottom: 1rem;
        right: 1rem;
        left: 1rem;
        text-align: center;
        justify-content: center;
    }
}

/* Print Styles */
@media print {
    .no-print {
        display: none !important;
    }

    body {
        background: white;
        color: black;
    }

    .card {
        box-shadow: none;
        border: 1px solid #ddd;
    }
}

/* Focus Styles for Accessibility */
:focus-visible {
    outline: 2px solid var(--accent-color);
    outline-offset: 2px;
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }
}
/* Editor Delete Button and Social Links */
.social-link-item {
    display: grid;
    grid-template-columns: 1fr 2fr auto;
    gap: 1rem;
    align-items: center;
    background: var(--sidebar-bg);
    padding: 1rem;
    border-radius: var(--input-border-radius);
    margin-bottom: 1rem;
    transition: all var(--transition-speed) ease;
}

.social-link-item:hover {
    background: var(--hover-bg);
    transform: translateX(5px);
}

.social-link-item select {
    width: 100%;
}

.remove-social {
    background: none;
    border: none;
    color: var(--error-color);
    cursor: pointer;
    font-size: 1.2rem;
    padding: 0.5rem;
    border-radius: var(--input-border-radius);
    transition: all var(--transition-speed) ease;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
}

.remove-social:hover {
    background: rgba(239, 68, 68, 0.1);
    transform: scale(1.1);
}

/* Preview Container Styles */
.preview-container {
    margin-top: 2rem;
    border: 1px solid var(--border-color);
    border-radius: var(--card-border-radius);
    overflow: hidden;
    position: relative;
    display: none;
    background: var(--sidebar-bg);
}

.preview-container.active {
    display: block;
}

.preview-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--sidebar-bg);
    border-bottom: 1px solid var(--border-color);
}

.preview-header h3 {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-primary);
}

.preview-device-selector {
    display: flex;
    gap: 0.5rem;
    margin-left: auto;
}

.preview-device-btn {
    padding: 0.5rem 1rem;
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    color: var(--text-secondary);
    border-radius: var(--input-border-radius);
    cursor: pointer;
    transition: all var(--transition-speed) ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
}

.preview-device-btn i {
    font-size: 1.1rem;
}

.preview-device-btn.active {
    background: var(--accent-color);
    color: var(--text-primary);
    border-color: var(--accent-color);
}

.preview-device-btn:hover:not(.active) {
    background: var(--hover-bg);
    color: var(--text-primary);
}

.preview-frame-container {
    position: relative;
    width: 100%;
    background: #000;
    transition: all var(--transition-speed) ease;
}

/* Device-specific styles */
.preview-frame-container.desktop {
    height: 600px;
}

.preview-frame-container.mobile {
    width: 375px;
    height: 667px;
    margin: 2rem auto;
    border-radius: 20px;
    border: 10px solid var(--sidebar-bg);
    box-shadow: 0 0 0 1px var(--border-color);
    position: relative;
}

.preview-frame-container.mobile:before {
    content: '';
    position: absolute;
    top: -20px;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 10px;
    background: var(--sidebar-bg);
    border-radius: 10px;
    border: 1px solid var(--border-color);
}

.preview-frame {
    width: 100%;
    height: 100%;
    border: none;
    background: #000;
    border-radius: inherit;
}

/* Preview Container Mobile Responsiveness */
@media (max-width: 768px) {
    .preview-container {
        margin-top: 1rem;
    }

    .preview-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
    }

    .preview-device-selector {
        margin-left: 0;
        width: 100%;
    }

    .preview-device-btn {
        flex: 1;
        justify-content: center;
    }

    .preview-frame-container.mobile {
        width: 100%;
        max-width: 375px;
        height: 600px;
        margin: 1rem auto;
    }

    .social-link-item {
        grid-template-columns: 1fr;
        gap: 0.75rem;
    }

    .social-link-item select,
    .social-link-item input {
        width: 100%;
    }

    .remove-social {
        margin-left: auto;
    }
}

/* Preview Container Tablet Responsiveness */
@media (min-width: 769px) and (max-width: 1024px) {
    .preview-frame-container.mobile {
        width: 320px;
        height: 568px;
    }
}
    </style>
</head>
<body>
    <div class="sidebar">
        <a href="#" class="logo">
            <img src="https://raw.githubusercontent.com/flyhighr/versz/a0fd36ef90141db837b1de18866379ce47769d62/download.svg" alt="Logo">
            <span>Versz</span>
        </a>
        
        <nav id="auth-nav">
            <div class="nav-item active" onclick="handleNavClick('login')">
                <i class="fas fa-sign-in-alt"></i>
                <span>Login</span>
            </div>
            <div class="nav-item" onclick="handleNavClick('register')">
                <i class="fas fa-user-plus"></i>
                <span>Register</span>
            </div>
        </nav>

        <nav id="app-nav" style="display: none;">
            <div class="nav-item active" onclick="handleNavClick('home')">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </div>
            <div class="nav-item" onclick="handleNavClick('editor')">
                <i class="fas fa-code"></i>
                <span>Editor</span>
            </div>
            <div class="nav-item" onclick="handleNavClick('profile')">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </div>
            <div class="nav-item" onclick="handleNavClick('upload')">
                <i class="fas fa-cloud-upload-alt"></i>
                <span>Upload</span>
            </div>
            <div class="nav-item" onclick="handleNavClick('myFiles')">
                <i class="fas fa-folder"></i>
                <span>My Files</span>
            </div>
            <div class="nav-item" onclick="handleLogout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </div>
        </nav>
    </div>

    <div class="main-content">
        <div id="authContainer">
            <div id="loginContainer" class="card">
                <h2>Login to Versz</h2>
                <input type="email" id="loginEmail" class="input" placeholder="Email">
                <input type="password" id="loginPassword" class="input" placeholder="Password">
                <button id="loginBtn" class="btn btn-primary">Login</button>
                <div id="loginError" class="error"></div>
                <div id="loginLoading" class="loading">
                    <div class="spinner"></div>
                </div>
                <p style="margin-top: 15px;">Forgot your password? <span class="link-text" onclick="showForgotPassword()">Reset it here</span></p>
            </div>

            <div id="registerContainer" class="card" style="display: none;">
                <h2>Create Account</h2>
                <input type="email" id="registerEmail" class="input" placeholder="Email">
                <input type="password" id="registerPassword" class="input" placeholder="Password">
                <input type="password" id="confirmPassword" class="input" placeholder="Confirm Password">
                <button id="registerBtn" class="btn btn-primary">Register</button>
                <div id="registerError" class="error"></div>
                <div id="registerLoading" class="loading">
                    <div class="spinner"></div>
                </div>
            </div>

            <div id="forgotPasswordContainer" class="card" style="display: none;">
                <h2>Reset Password</h2>
                <div id="resetStep1">
                    <input type="email" id="forgotPasswordEmail" class="input" placeholder="Email">
                    <button id="forgotPasswordBtn" class="btn btn-primary">Send Reset Code</button>
                </div>
                
                <div id="resetStep2" style="display: none;">
                    <input type="text" id="resetCode" class="input" placeholder="Reset Code">
                    <input type="password" id="newPassword" class="input" placeholder="New Password">
                    <input type="password" id="confirmNewPassword" class="input" placeholder="Confirm New Password">
                    <button id="submitResetBtn" class="btn btn-primary">Reset Password</button>
                </div>

                <div id="forgotPasswordError" class="error"></div>
                <div id="forgotPasswordSuccess" class="success"></div>
                <div id="forgotPasswordLoading" class="loading">
                    <div class="spinner"></div>
                </div>
                <p style="margin-top: 15px;">
                    <span class="link-text" onclick="switchAuthTab('login')">Back to Login</span>
                </p>
            </div>
        </div>

        <div id="appContainer" style="display: none;">
            <div id="homeContainer" class="card">
                <div class="home-content">
                    <h1>Welcome to Versz</h1>
                    <p>Create and share your bio pages easily.</p>
                </div>
            </div>
            <div id="editorContainer" class="card" style="display: none;">
                <div class="editor-header">
                    <h2>Profile Page Editor</h2>
                    <p>Customize your profile page template</p>
                </div>
                
                <div class="editor-sections">
                    <!-- Layout Settings -->
                    <div class="editor-section">
                        <h3>Layout</h3>
                        <div class="setting-group">
                            <label>Profile Position</label>
                            <select id="profilePosition" class="input">
                                <option value="center">Center</option>
                                <option value="top-left">Top Left</option>
                                <option value="top-right">Top Right</option>
                                <option value="bottom-left">Bottom Left</option>
                                <option value="bottom-right">Bottom Right</option>
                            </select>
                        </div>
                        
                        <div class="setting-group">
                            <label>Container Transparency</label>
                            <input type="range" id="containerOpacity" min="0" max="100" value="65" class="input">
                            <span id="opacityValue">65%</span>
                        </div>
                    </div>
            
                    <!-- Background Settings -->
                    <div class="editor-section">
                        <h3>Background</h3>
                        <div class="setting-group">
                            <label>Background Type</label>
                            <select id="bgType" class="input">
                                <option value="image">Image</option>
                                <option value="video">Video</option>
                            </select>
                        </div>
                        
                        <div class="setting-group">
                            <label>Background URL</label>
                            <input type="text" id="bgUrl" class="input" placeholder="Enter URL">
                        </div>
                    </div>
            
                    <!-- Font Settings -->
                    <div class="editor-section">
                        <h3>Typography</h3>
                        <div class="setting-group">
                            <label>Font Family</label>
                            <select id="fontFamily" class="input">
                                <option value="Space Grotesk">Space Grotesk</option>
                                <option value="Poppins">Poppins</option>
                                <option value="Montserrat">Montserrat</option>
                                <option value="Roboto">Roboto</option>
                                <option value="Inter">Inter</option>
                            </select>
                        </div>
                        
                        <div class="setting-group">
                            <label>Name Font Size</label>
                            <input type="range" id="nameFontSize" min="16" max="32" value="22" class="input">
                            <span id="nameFontSizeValue">22px</span>
                        </div>
                    </div>
                    <!-- Colors Section -->
                    <div class="editor-section">
                        <h3>Colors</h3>
                        <div class="color-grid">
                            <div class="setting-group">
                                <label>Profile Icon</label>
                                <div class="color-picker-wrapper">
                                    <input type="color" id="profileIconColor" class="input color-input" value="#ffffff">
                                    <input type="text" class="input color-text" data-color-input="profileIconColor" value="#ffffff">
                                </div>
                            </div>
                    
                            <div class="setting-group">
                                <label>Text Color</label>
                                <div class="color-picker-wrapper">
                                    <input type="color" id="textColor" class="input color-input" value="#ffffff">
                                    <input type="text" class="input color-text" data-color-input="textColor" value="#ffffff">
                                </div>
                            </div>
                    
                            <div class="setting-group">
                                <label>Secondary Text</label>
                                <div class="color-picker-wrapper">
                                    <input type="color" id="secondaryTextColor" class="input color-input" value="#ffffff">
                                    <input type="text" class="input color-text" data-color-input="secondaryTextColor" value="#ffffff">
                                    <input type="range" class="input opacity-range" data-opacity-for="secondaryTextColor" min="0" max="100" value="70">
                                    <span class="opacity-value">70%</span>
                                </div>
                            </div>
                    
                            <div class="setting-group">
                                <label>Container Border</label>
                                <div class="color-picker-wrapper">
                                    <input type="color" id="containerBorderColor" class="input color-input" value="#ffffff">
                                    <input type="text" class="input color-text" data-color-input="containerBorderColor" value="#ffffff">
                                    <input type="range" class="input opacity-range" data-opacity-for="containerBorderColor" min="0" max="100" value="10">
                                    <span class="opacity-value">10%</span>
                                </div>
                            </div>
                    
                            <div class="setting-group">
                                <label>Social Icons</label>
                                <div class="color-picker-wrapper">
                                    <input type="color" id="socialIconsColor" class="input color-input" value="#ffffff">
                                    <input type="text" class="input color-text" data-color-input="socialIconsColor" value="#ffffff">
                                </div>
                            </div>
                    
                            <div class="setting-group">
                                <label>Social Icons Hover</label>
                                <div class="color-picker-wrapper">
                                    <input type="color" id="socialIconsHoverColor" class="input color-input" value="#3b82f6">
                                    <input type="text" class="input color-text" data-color-input="socialIconsHoverColor" value="#3b82f6">
                                </div>
                            </div>
                        </div>
                    </div>
            
                    <!-- Profile Content -->
                    <div class="editor-section">
                        <h3>Profile Content</h3>
                        <div class="setting-group">
                            <label>Profile Name</label>
                            <input type="text" id="profileName" class="input" value="Flyhigh">
                        </div>
                        
                        <div class="setting-group">
                            <label>Bio Type</label>
                            <select id="bioType" class="input">
                                <option value="static">Static Bio</option>
                                <option value="quotes">Rotating Quotes</option>
                            </select>
                        </div>
                        
                        <div id="staticBioContainer" class="setting-group">
                            <label>Static Bio</label>
                            <textarea id="staticBio" class="input" rows="3"></textarea>
                        </div>
                        
                        <div id="quotesContainer" class="setting-group">
                            <label>Quotes (One per line)</label>
                            <textarea id="quotes" class="input" rows="5"></textarea>
                        </div>
                    </div>
            
                    <!-- Social Links -->
                    <div class="editor-section">
                        <h3>Social Links</h3>
                        <div id="socialLinksContainer">
                            <!-- Social links will be added dynamically -->
                        </div>
                        <button id="addSocialLink" class="btn">Add Social Link</button>
                    </div>
            
                    <!-- Initial Screen -->
                    <div class="editor-section">
                        <h3>Initial Screen</h3>
                        <div class="setting-group">
                            <label>Screen Color</label>
                            <input type="color" id="initialScreenColor" class="input" value="#000000">
                        </div>
                        
                        <div class="setting-group">
                            <label>Center Icon</label>
                            <input type="text" id="centerIcon" class="input" placeholder="Emoji or Image URL">
                        </div>
                    </div>
                </div>
            
                <div class="editor-actions">
                    <button id="previewChanges" class="btn">Preview</button>
                    <button id="downloadHtml" class="btn">Download HTML</button>
                    <button id="uploadTemplate" class="btn btn-primary">Upload</button>
                </div>
            
                <div id="editorPreview" class="preview-container">
                    <div class="preview-header">
                        <h3>Preview</h3>
                        <div class="preview-device-selector">
                            <button class="preview-device-btn active" data-device="desktop">
                                <i class="fas fa-desktop"></i> Desktop
                            </button>
                            <button class="preview-device-btn" data-device="mobile">
                                <i class="fas fa-mobile-alt"></i> Mobile
                            </button>
                        </div>
                    </div>
                    <div class="preview-frame-container desktop">
                        <iframe id="previewFrame" class="preview-frame"></iframe>
                    </div>
                </div>
            </div>
            <div id="uploadModal" class="modal">
                <div class="modal-content">
                    <h2>Upload Template</h2>
                    <div class="upload-options">
                        <div class="setting-group">
                            <label>Custom URL (optional)</label>
                            <input type="text" id="uploadCustomUrl" class="input" placeholder="Enter custom URL">
                            <span class="helper-text">Leave empty for auto-generated URL</span>
                        </div>
                        
                        <div class="upload-preview">
                            <h3>Template Details</h3>
                            <div class="template-info">
                                <div class="info-item">
                                    <span class="label">Name:</span>
                                    <span class="value" id="previewName"></span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Social Links:</span>
                                    <span class="value" id="previewSocialCount"></span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Bio Type:</span>
                                    <span class="value" id="previewBioType"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button id="confirmUpload" class="btn btn-primary">
                            <i class="fas fa-cloud-upload-alt"></i> Upload
                        </button>
                        <button id="cancelUpload" class="btn">Cancel</button>
                    </div>
                    
                    <div id="uploadStatus" class="upload-status">
                        <div class="status-message"></div>
                        <div class="status-progress">
                            <div class="progress-bar"></div>
                        </div>
                    </div>
                </div>
            </div>


            <div id="profileSection" class="card" style="display: none;">
                <div class="profile-section">
                    <h2>My Profile</h2>
                    <div class="profile-info">
                        <div class="profile-stat">
                            <div class="profile-stat-label">Email</div>
                            <div class="profile-stat-value" id="profileEmail"></div>
                        </div>
                        <div class="profile-stat">
                            <div class="profile-stat-label">User ID</div>
                            <div class="profile-stat-value" id="profileUserId"></div>
                        </div>
                        <div class="profile-stat">
                            <div class="profile-stat-label">URLs</div>
                            <div class="profile-stat-value" id="profileUrlCount"></div>
                        </div>
                    </div>
                    <div class="tags-container" id="profileTags"></div>
                </div>

                <div class="preferences-section">
                    <h3>Display Preferences</h3>
                    <div class="preference-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" id="showViews">
                            <span class="toggle-slider"></span>
                        </label>
                        <label>Show view count</label>
                    </div>
                    <div class="preference-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" id="showUuid">
                            <span class="toggle-slider"></span>
                        </label>
                        <label>Show UUID</label>
                    </div>
                    <div class="preference-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" id="showTags">
                            <span class="toggle-slider"></span>
                        </label>
                        <label>Show tags</label>
                    </div>
                    <button id="savePreferences" class="btn btn-primary">Save Preferences</button>
                </div>
            </div>

            <div id="uploadContainer" class="card" style="display: none;">
                <div class="upload-section">
                    <h2>Upload File</h2>
                    <div class="file-input-container">
                        <input type="file" id="fileInput" accept=".html" class="input">
                        <div id="selectedFile"></div>
                    </div>
                    <div class="custom-url-input">
                        <input type="text" id="customUrl" class="input" placeholder="Custom URL (optional)">
                    </div>
                    <button id="uploadBtn" class="btn btn-primary" disabled>Upload</button>
                    <div id="uploadError" class="error"></div>
                    <div id="uploadSuccess" class="success"></div>
                    <div id="uploadLoading" class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>

            <div id="myFilesContainer" style="display: none;">
                <div class="file-list" id="fileList">
                    <!-- Files will be dynamically added here -->
                </div>
            </div>
            <div id="updateFileModal" class="modal">
                <div class="modal-content">
                    <h2>Update File</h2>
                    <div class="file-input-container">
                        <input type="file" id="updateFileInput" accept=".html" class="input">
                        <div id="updateSelectedFile"></div>
                    </div>
                    <div class="modal-actions">
                        <button id="submitUpdateBtn" class="btn btn-primary" disabled>Update</button>
                        <button id="cancelUpdateBtn" class="btn">Cancel</button>
                    </div>
                    <div id="updateError" class="error"></div>
                    <div id="updateSuccess" class="success"></div>
                    <div id="updateLoading" class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
    </div>

    <div id="verifyEmailContainer">
          <button class="close-button" onclick="hideVerifyEmail()">×</button>
          <h2>Verify Your Email</h2>
          <p>We've sent a verification link to your email address. Please check your inbox and click the link to verify your account.</p>
          <p>Didn't receive the email? <span class="link-text" onclick="resendVerificationLink()">Resend verification email</span></p>
          <div id="verifyError" class="error"></div>
          <div id="verifySuccess" class="success"></div>
          <div id="verifyLoading" class="loading">
              <div class="spinner"></div>
          </div>
      </div>

    <div class="overlay"></div>
    <script>
      const BASE_URL = 'https://versz-vs1b.onrender.com';
const FRONTEND_URL = 'https://versz.fun';
let token = localStorage.getItem('token');
let userId = localStorage.getItem('userId');
let userEmail = localStorage.getItem('userEmail');
let isVerified = localStorage.getItem('isVerified') === 'true';
let currentUrl = null;
let currentUpdateUrl = null;

// Editor State Management
let editorState = {
    layout: {
        position: 'center',
        opacity: 65,
    },
    colors: {
        profileIcon: '#ffffff',
        text: '#ffffff',
        secondaryText: 'rgba(255, 255, 255, 0.7)',
        containerBorder: 'rgba(255, 255, 255, 0.1)',
        socialIcons: '#ffffff',
        socialIconsHover: '#3b82f6'
    },
    background: {
        type: 'image',
        url: 'https://discord.cloud/i/in73uu9qu'
    },
    typography: {
        fontFamily: 'Space Grotesk',
        nameSize: 22,
        bioSize: 17
    },
    content: {
        name: 'Flyhigh',
        bioType: 'quotes',
        staticBio: '',
        quotes: [
            "Be loyal to your own piece of mind.",
            "Life is just a beautiful game.",
            "In the chaos, find your peace.",
            "Dream big, stay humble.",
            "Create your own destiny.",
            "Chase sunsets, not validation.",
            "Be the energy you want to attract.",
            "Find beauty in the journey."
        ]
    },
    initialScreen: {
        color: '#000000',
        icon: '🍓'
    },
    socialLinks: [
        { platform: 'instagram', url: 'https://instagram.com', icon: 'fab fa-instagram' },
        { platform: 'discord', url: 'https://discord.com', icon: 'fab fa-discord' },
        { platform: 'github', url: 'https://github.com', icon: 'fab fa-github' },
        { platform: 'pinterest', url: 'https://in.pinterest.com', icon: 'fab fa-pinterest' },
        { platform: 'spotify', url: 'https://open.spotify.com/user/', icon: 'fab fa-spotify' }
    ]
};

// Available Social Platforms
const socialPlatforms = {
    instagram: { name: 'Instagram', icon: 'fab fa-instagram' },
    discord: { name: 'Discord', icon: 'fab fa-discord' },
    github: { name: 'GitHub', icon: 'fab fa-github' },
    pinterest: { name: 'Pinterest', icon: 'fab fa-pinterest' },
    spotify: { name: 'Spotify', icon: 'fab fa-spotify' },
    twitter: { name: 'Twitter', icon: 'fab fa-twitter' },
    facebook: { name: 'Facebook', icon: 'fab fa-facebook' },
    youtube: { name: 'YouTube', icon: 'fab fa-youtube' },
    twitch: { name: 'Twitch', icon: 'fab fa-twitch' },
    linkedin: { name: 'LinkedIn', icon: 'fab fa-linkedin' },
    reddit: { name: 'Reddit', icon: 'fab fa-reddit' },
    website: { name: 'Website', icon: 'fas fa-globe' }
};

// Initialize Editor
function initializeEditor() {
    if (!document.getElementById('editorContainer')) {
        console.error('Editor container not found');
        return;
    }

    // Set initial values
    document.getElementById('profilePosition').value = editorState.layout.position;
    document.getElementById('containerOpacity').value = editorState.layout.opacity;
    updateValueDisplay('containerOpacity', 'opacityValue', '%');
    
    document.getElementById('bgType').value = editorState.background.type;
    document.getElementById('bgUrl').value = editorState.background.url;
    
    document.getElementById('fontFamily').value = editorState.typography.fontFamily;
    document.getElementById('nameFontSize').value = editorState.typography.nameSize;
    updateValueDisplay('nameFontSize', 'nameFontSizeValue', 'px');
    
    document.getElementById('profileName').value = editorState.content.name;
    document.getElementById('bioType').value = editorState.content.bioType;
    document.getElementById('quotes').value = editorState.content.quotes.join('\n');
    document.getElementById('initialScreenColor').value = editorState.initialScreen.color;
    document.getElementById('centerIcon').value = editorState.initialScreen.icon;

    // Show/hide bio containers based on type
    const bioType = document.getElementById('bioType').value;
    document.getElementById('staticBioContainer').style.display = bioType === 'static' ? 'block' : 'none';
    document.getElementById('quotesContainer').style.display = bioType === 'quotes' ? 'block' : 'none';
     document.getElementById('profileIconColor').value = editorState.colors.profileIcon;
    document.getElementById('textColor').value = editorState.colors.text;
    document.getElementById('secondaryTextColor').value = editorState.colors.secondaryText;
    document.getElementById('containerBorderColor').value = editorState.colors.containerBorder;
    document.getElementById('socialIconsColor').value = editorState.colors.socialIcons;
    document.getElementById('socialIconsHoverColor').value = editorState.colors.socialIconsHover;

    setupColorPickers();

    // Initialize social links
    renderSocialLinks();

    // Setup all event listeners
    setupEventListeners();

    // Setup preview
    setupPreview();

    // Generate initial preview
    generatePreview();
}

// Setup Event Listeners
function updateValueDisplay(inputId, displayId, suffix = '') {
    const input = document.getElementById(inputId);
    const display = document.getElementById(displayId);
    if (input && display) {
        display.textContent = input.value + suffix;
    }
}

// Update the event listeners setup
function setupEventListeners() {
    // Typography and Layout controls
    const controlsConfig = {
        'containerOpacity': {
            displayId: 'opacityValue',
            suffix: '%',
            update: (value) => {
                editorState.layout.opacity = value;
                updateValueDisplay('containerOpacity', 'opacityValue', '%');
            }
        },
        'nameFontSize': {
            displayId: 'nameFontSizeValue',
            suffix: 'px',
            update: (value) => {
                editorState.typography.nameSize = value;
                updateValueDisplay('nameFontSize', 'nameFontSizeValue', 'px');
            }
        },
        'fontFamily': {
            update: (value) => {
                editorState.typography.fontFamily = value;
            }
        },
        'profilePosition': {
            update: (value) => {
                editorState.layout.position = value;
            }
        }
    };

    // Setup control listeners
    Object.keys(controlsConfig).forEach(controlId => {
        const element = document.getElementById(controlId);
        if (element) {
            ['input', 'change'].forEach(eventType => {
                element.addEventListener(eventType, (e) => {
                    controlsConfig[controlId].update(e.target.value);
                    updatePreview();
                });
            });
        }
    });

    // Background settings
    document.getElementById('bgType').addEventListener('change', updateBackground);
    document.getElementById('bgUrl').addEventListener('input', debounce(updateBackground, 500));

    // Content settings
    document.getElementById('profileName').addEventListener('input', updateContent);
    document.getElementById('bioType').addEventListener('change', updateContent);
    document.getElementById('quotes').addEventListener('input', debounce(updateContent, 500));
    document.getElementById('staticBio').addEventListener('input', debounce(updateContent, 500));

    // Initial screen settings
    document.getElementById('initialScreenColor').addEventListener('input', updateInitialScreen);
    document.getElementById('centerIcon').addEventListener('input', updateInitialScreen);

    // Preview and action buttons
    document.getElementById('previewChanges').addEventListener('click', generatePreview);
    document.getElementById('downloadHtml').addEventListener('click', downloadTemplate);
    document.getElementById('uploadTemplate').addEventListener('click', uploadTemplate);
    document.getElementById('addSocialLink').addEventListener('click', addSocialLink);
}

function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}
// Update Functions
function updateLayout(e) {
    editorState.layout.position = document.getElementById('profilePosition').value;
    editorState.layout.opacity = document.getElementById('containerOpacity').value;
    updatePreview();
}

function updateBackground() {
    editorState.background.type = document.getElementById('bgType').value;
    editorState.background.url = document.getElementById('bgUrl').value;
    updatePreview();
}
function updateTypography(e) {
    editorState.typography.fontFamily = document.getElementById('fontFamily').value;
    editorState.typography.nameSize = document.getElementById('nameFontSize').value;
    updatePreview();
}

function updateContent() {
    editorState.content.name = document.getElementById('profileName').value;
    editorState.content.bioType = document.getElementById('bioType').value;
    
    // Update bio containers visibility
    document.getElementById('staticBioContainer').style.display = 
        editorState.content.bioType === 'static' ? 'block' : 'none';
    document.getElementById('quotesContainer').style.display = 
        editorState.content.bioType === 'quotes' ? 'block' : 'none';
    
    if (editorState.content.bioType === 'quotes') {
        editorState.content.quotes = document.getElementById('quotes').value
            .split('\n')
            .filter(quote => quote.trim());
    } else {
        editorState.content.staticBio = document.getElementById('staticBio').value;
    }
    
    updatePreview();
}

function updateInitialScreen() {
    editorState.initialScreen.color = document.getElementById('initialScreenColor').value;
    editorState.initialScreen.icon = document.getElementById('centerIcon').value;
    updatePreview();
}

// Social Links Management
function renderSocialLinks() {
    const container = document.getElementById('socialLinksContainer');
    container.innerHTML = '';

    editorState.socialLinks.forEach((link, index) => {
        const linkElement = createSocialLinkElement(link, index);
        container.appendChild(linkElement);
    });
}

function createSocialLinkElement(link, index) {
    const div = document.createElement('div');
    div.className = 'social-link-item';
    div.innerHTML = `
        <select class="input" onchange="updateSocialLink(${index}, 'platform', this.value)">
            ${Object.entries(socialPlatforms).map(([key, platform]) => `
                <option value="${key}" ${link.platform === key ? 'selected' : ''}>
                    ${platform.name}
                </option>
            `).join('')}
        </select>
        <input type="text" class="input" value="${link.url}" 
               onchange="updateSocialLink(${index}, 'url', this.value)" 
               placeholder="Enter URL">
        <button class="remove-social" onclick="removeSocialLink(${index})">
            <i class="fas fa-trash"></i>
        </button>
    `;
    return div;
}
// Add to setupEventListeners function
function setupColorPickers() {
    const colorInputs = document.querySelectorAll('.color-input');
    const colorTexts = document.querySelectorAll('.color-text');
    const opacityRanges = document.querySelectorAll('.opacity-range');

    // Handle color picker changes
    colorInputs.forEach(input => {
        input.addEventListener('input', (e) => {
            const textInput = document.querySelector(`[data-color-input="${input.id}"]`);
            textInput.value = e.target.value;
            updateColors(input.id, e.target.value);
        });
    });

    // Handle text input changes
    colorTexts.forEach(input => {
        input.addEventListener('input', (e) => {
            const colorInput = document.getElementById(input.dataset.colorInput);
            if (isValidColor(e.target.value)) {
                colorInput.value = e.target.value;
                updateColors(input.dataset.colorInput, e.target.value);
            }
        });
    });

    // Handle opacity changes
    opacityRanges.forEach(range => {
        range.addEventListener('input', (e) => {
            const colorId = range.dataset.opacityFor;
            const colorInput = document.getElementById(colorId);
            const opacityValue = range.nextElementSibling;
            opacityValue.textContent = `${e.target.value}%`;
            
            updateColors(colorId, colorInput.value, e.target.value);
        });
    });
}

function isValidColor(color) {
    const s = new Option().style;
    s.color = color;
    return s.color !== '';
}

function updateColors(id, color, opacity = null) {
    switch(id) {
        case 'profileIconColor':
            editorState.colors.profileIcon = color;
            break;
        case 'textColor':
            editorState.colors.text = color;
            break;
        case 'secondaryTextColor':
            editorState.colors.secondaryText = opacity 
                ? `rgba(${hexToRgb(color).join(', ')}, ${opacity/100})`
                : color;
            break;
        case 'containerBorderColor':
            editorState.colors.containerBorder = opacity 
                ? `rgba(${hexToRgb(color).join(', ')}, ${opacity/100})`
                : color;
            break;
        case 'socialIconsColor':
            editorState.colors.socialIcons = color;
            break;
        case 'socialIconsHoverColor':
            editorState.colors.socialIconsHover = color;
            break;
    }
    updatePreview();
}

function hexToRgb(hex) {
    // Remove # if present
    hex = hex.replace('#', '');
    
    // Convert 3-digit hex to 6-digits
    if (hex.length === 3) {
        hex = hex.split('').map(char => char + char).join('');
    }
    
    const r = parseInt(hex.substr(0, 2), 16);
    const g = parseInt(hex.substr(2, 2), 16);
    const b = parseInt(hex.substr(4, 2), 16);
    
    return [r, g, b];
}
function addSocialLink() {
    if (editorState.socialLinks.length >= 10) {
        alert('Maximum 10 social links allowed');
        return;
    }
    
    editorState.socialLinks.push({
        platform: 'website',
        url: '',
        icon: 'fas fa-globe'
    });
    
    renderSocialLinks();
    updatePreview();
}

function updateSocialLink(index, property, value) {
    editorState.socialLinks[index][property] = value;
    if (property === 'platform') {
        editorState.socialLinks[index].icon = socialPlatforms[value].icon;
    }
    updatePreview();
}

function removeSocialLink(index) {
    editorState.socialLinks.splice(index, 1);
    renderSocialLinks();
    updatePreview();
}

// Preview Generation
function generatePreview() {
    const previewContainer = document.getElementById('editorPreview');
    const previewFrame = document.getElementById('previewFrame');
    previewContainer.classList.add('active');
    
    // Generate template
    const template = generateTemplate();
    
    // Create blob and URL
    const blob = new Blob([template], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    
    // Load preview in iframe
    previewFrame.src = url;
    
    // Clean up old URL after load
    previewFrame.onload = () => {
        URL.revokeObjectURL(previewFrame.src);
    };
}

// Template Generation
function generateTemplate() {
    const parts = [];
    const escapeHtml = (unsafe) => {
        return unsafe
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    };

    const getPositionStyles = () => {
        switch (editorState.layout.position) {
            case 'top-left':
                return 'top: 2rem; left: 2rem; transform: none;';
            case 'top-right':
                return 'top: 2rem; right: 2rem; transform: none;';
            case 'bottom-left':
                return 'bottom: 2rem; left: 2rem; transform: none;';
            case 'bottom-right':
                return 'bottom: 2rem; right: 2rem; transform: none;';
            default:
                return 'top: 50%; left: 50%; transform: translate(-50%, -50%);';
        }
    };

    const socialLinksHtml = editorState.socialLinks
        .map(link => `
            <a href="${escapeHtml(link.url)}" target="_blank">
                <i class="${escapeHtml(link.icon)}"></i>
            </a>
        `).join('\n');

    const quotesArray = editorState.content.bioType === 'quotes'
        ? `const quotes = ${JSON.stringify(editorState.content.quotes)};`
        : '';

    // Start building HTML
    parts.push('<!DOCTYPE html>');
    parts.push('<html lang="en">');
    parts.push('<head>');
    parts.push('    <meta charset="UTF-8">');
    parts.push('    <meta name="viewport" content="width=device-width, initial-scale=1.0">');
    parts.push('    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">');
    parts.push(`    <title>${escapeHtml(editorState.content.name)}'s Profile</title>`);
    
    // Styles
    parts.push('    <style>');
    parts.push(`        @import url('https://fonts.googleapis.com/css2?family=${editorState.typography.fontFamily.replace(' ', '+')}&display=swap');`);
    parts.push(`
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body, html {
            width: 100%;
            height: 100%;
            background: #000;
            overflow: hidden;
            font-family: '${editorState.typography.fontFamily}', sans-serif;
            color: #ffffff;
        }
        
        .media-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.8s ease;
        }
        
        .media-container video,
        .media-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .content {
            position: fixed;
            ${getPositionStyles()}
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 15px;
            opacity: 0;
            transition: opacity 0.8s ease;
            background: rgba(0, 0, 0, ${editorState.layout.opacity / 100});
            padding: 2rem;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            min-width: 280px;
            max-width: 500px;
            width: 85%;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            gap: 15px;
            width: 100%;
        }
        
        .profile-icon {
            width: 42px;
            height: 42px;
            background: #ffffff;
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        .profile-info {
            flex-grow: 1;
        }
        
        .profile-name {
            font-size: ${editorState.typography.nameSize}px;
            font-weight: 500;
            margin-bottom: 2px;
        }
        
        .join-date {
            font-size: 13px;
            opacity: 0.7;
        }
        
        .quote-container {
            width: 100%;
            min-height: 48px;
            font-size: ${editorState.typography.bioSize}px;
            line-height: 1.4;
        }
        
        .social-links {
            display: flex;
            gap: 12px;
            margin-top: 5px;
            opacity: 0.8;
            flex-wrap: wrap;
        }
        
        .social-links a {
            color: #ffffff;
            font-size: 18px;
            transition: all 0.2s ease;
            text-decoration: none;
        }
        
        .social-links a:hover {
            opacity: 1;
            transform: scale(1.1);
        }
        
        .initial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: ${editorState.initialScreen.color};
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: opacity 0.5s ease;
        }

        .initial-overlay span {
            transform: scale(1);
            transition: transform 0.3s ease;
        }

        .initial-overlay:hover span {
            transform: scale(1.2);
        }

        @media (max-width: 768px) {
            .content {
                padding: 1.5rem;
                width: 80%;
                min-width: 240px;
                gap: 12px;
            }
            
            .profile-icon {
                width: 36px;
                height: 36px;
            }
            
            .profile-name {
                font-size: ${Math.max(16, editorState.typography.nameSize - 4)}px;
            }
            
            .quote-container {
                font-size: ${Math.max(14, editorState.typography.bioSize - 2)}px;
            }
            
            .social-links {
                gap: 10px;
            }
            
            .social-links a {
                font-size: 16px;
            }
        }
    `);
    parts.push(`
        .profile-icon {
            background: ${editorState.colors.profileIcon};
        }
        
        body {
            color: ${editorState.colors.text};
        }
        
        .join-date,
        .quote-container {
            color: ${editorState.colors.secondaryText};
        }
        
        .content {
            border: 1px solid ${editorState.colors.containerBorder};
        }
        
        .social-links a {
            color: ${editorState.colors.socialIcons};
        }
        
        .social-links a:hover {
            color: ${editorState.colors.socialIconsHover};
        }
    `);
    parts.push('    </style>');
    parts.push('</head>');
    parts.push('<body>');

    // Media Container
    parts.push('    <div class="media-container" id="mediaContainer">');
    if (editorState.background.type === 'video') {
        parts.push('        <video autoplay loop muted playsinline>');
        parts.push(`            <source src="${escapeHtml(editorState.background.url)}" type="video/mp4">`);
        parts.push('        </video>');
    } else {
        parts.push(`        <img src="${escapeHtml(editorState.background.url)}" alt="background">`);
    }
    parts.push('    </div>');

    // Content
    parts.push('    <div class="content">');
    parts.push(`        <div class="profile-header">
            <div class="profile-icon"></div>
            <div class="profile-info">
                <div class="profile-name">${escapeHtml(editorState.content.name)}</div>
                <div class="join-date">joined ${new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</div>
            </div>
        </div>`);

    parts.push(`        <div class="quote-container" id="quote">
            ${editorState.content.bioType === 'static' ? escapeHtml(editorState.content.staticBio) : ''}
        </div>`);

    parts.push(`        <div class="social-links">
            ${socialLinksHtml}
        </div>`);
    parts.push('    </div>');

    // Initial Overlay
    parts.push(`    <div class="initial-overlay">
        <span style="font-size: 30px;">${escapeHtml(editorState.initialScreen.icon)}</span>
    </div>`);

    // Scripts
    parts.push('<script>');
    if (editorState.content.bioType === 'quotes') {
        parts.push(quotesArray);
    }
    parts.push(`
        class TypeWriter {
            constructor(element, words) {
                this.element = element;
                this.words = words;
                this.txt = '';
                this.wordIndex = 0;
                this.isDeleting = false;
                this.type();
            }

            type() {
                const current = this.wordIndex % this.words.length;
                const fullTxt = this.words[current];

                if (this.isDeleting) {
                    this.txt = fullTxt.substring(0, this.txt.length - 1);
                } else {
                    this.txt = fullTxt.substring(0, this.txt.length + 1);
                }

                this.element.innerHTML = '<span>' + this.txt + '</span>';

                let typeSpeed = 50;

                if (this.isDeleting) {
                    typeSpeed /= 2;
                }

                if (!this.isDeleting && this.txt === fullTxt) {
                    typeSpeed = 3000;
                    this.isDeleting = true;
                } else if (this.isDeleting && this.txt === '') {
                    this.isDeleting = false;
                    this.wordIndex++;
                    typeSpeed = 500;
                }

                setTimeout(() => this.type(), typeSpeed);
            }
        }

        const mediaContainer = document.querySelector('.media-container');
        const content = document.querySelector('.content');
        const initialOverlay = document.querySelector('.initial-overlay');
        
        initialOverlay.addEventListener('click', function() {
            initialOverlay.style.opacity = 0;
            setTimeout(() => {
                initialOverlay.style.display = 'none';
            }, 500);
            
            mediaContainer.style.opacity = 1;
            content.style.opacity = 1;
            
            ${editorState.content.bioType === 'quotes' ? 'new TypeWriter(document.getElementById("quote"), quotes);' : ''}
        });
    `);
    parts.push('<\/script>');
    parts.push('</body>');
    parts.push('</html>');

    return parts.join('\n');
}

function setupPreview() {
    const previewContainer = document.getElementById('editorPreview');
    const frameContainer = previewContainer.querySelector('.preview-frame-container');
    const deviceButtons = previewContainer.querySelectorAll('.preview-device-btn');
    
    deviceButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            // Update active button
            deviceButtons.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Update preview container
            frameContainer.className = 'preview-frame-container ' + btn.dataset.device;
            
            // Refresh preview to ensure proper rendering
            updatePreview();
        });
    });
}
function updatePreview() {
    if (document.getElementById('editorPreview').classList.contains('active')) {
        generatePreview();
    }
}

// Download Template
function downloadTemplate() {
    const template = generateTemplate();
    const blob = new Blob([template], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = 'profile-template.html';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// Upload Template
// Enhanced upload functionality
async function uploadTemplate() {
    const modal = document.getElementById('uploadModal');
    const statusContainer = document.getElementById('uploadStatus');
    const statusMessage = statusContainer.querySelector('.status-message');
    const progressBar = statusContainer.querySelector('.progress-bar');
    
    // Show template preview info
    document.getElementById('previewName').textContent = editorState.content.name;
    document.getElementById('previewSocialCount').textContent = `${editorState.socialLinks.length} links`;
    document.getElementById('previewBioType').textContent = editorState.content.bioType === 'quotes' ? 'Rotating Quotes' : 'Static Bio';
    
    // Show modal
    modal.classList.add('active');
    document.querySelector('.overlay').classList.add('active');
    
    // Setup modal buttons
    document.getElementById('cancelUpload').onclick = () => {
        modal.classList.remove('active');
        document.querySelector('.overlay').classList.remove('active');
        statusContainer.classList.remove('active');
        statusMessage.innerHTML = '';
        progressBar.style.width = '0%';
    };
    
    document.getElementById('confirmUpload').onclick = async () => {
        try {
            statusContainer.classList.add('active');
            const customUrl = document.getElementById('uploadCustomUrl').value.trim();
            
            // Generate template
            statusMessage.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating template...';
            progressBar.style.width = '30%';
            
            const template = generateTemplate();
            const blob = new Blob([template], { type: 'text/html' });
            const file = new File([blob], 'profile-template.html', { type: 'text/html' });
            
            // Prepare upload
            const formData = new FormData();
            formData.append('file', file);
            
            // Start upload
            statusMessage.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> Uploading...';
            progressBar.style.width = '60%';
            
            let url = `${BASE_URL}/upload`;
            if (customUrl) {
                url += `?custom_url=${encodeURIComponent(customUrl)}`;
            }
            
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`
                },
                body: formData
            });
            
            const data = await response.json();
            
            if (response.ok) {
                progressBar.style.width = '100%';
                const finalUrl = `${FRONTEND_URL}/${data.url}`;
                statusMessage.innerHTML = `
                    <div class="upload-success">
                        <i class="fas fa-check-circle"></i> Upload successful!
                    </div>
                    <div class="uploaded-url">
                        <span>${finalUrl}</span>
                        <button class="copy-btn" onclick="copyToClipboard('${finalUrl}')">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                `;
                
                // Refresh file list
                fetchUserFiles();
                
                // Auto close after delay
                setTimeout(() => {
                    modal.classList.remove('active');
                    document.querySelector('.overlay').classList.remove('active');
                    statusContainer.classList.remove('active');
                    statusMessage.innerHTML = '';
                    progressBar.style.width = '0%';
                }, 3000);
            } else {
                throw new Error(data.detail || 'Upload failed');
            }
        } catch (error) {
            progressBar.style.width = '100%';
            statusMessage.innerHTML = `
                <div class="upload-error">
                    <i class="fas fa-exclamation-circle"></i> ${error.message}
                </div>
            `;
        }
    };
}

// Helper function to copy URL
async function copyToClipboard(text) {
    try {
        await navigator.clipboard.writeText(text);
        const copyBtn = document.querySelector('.copy-btn');
        const originalHTML = copyBtn.innerHTML;
        copyBtn.innerHTML = '<i class="fas fa-check"></i>';
        setTimeout(() => {
            copyBtn.innerHTML = originalHTML;
        }, 2000);
    } catch (err) {
        console.error('Failed to copy:', err);
    }
}


function showUpdateFile(url) {
    currentUpdateUrl = url;
    document.getElementById('updateFileModal').classList.add('active');
    document.getElementById('updateFileInput').value = '';
    document.getElementById('updateSelectedFile').textContent = '';
    document.getElementById('updateError').textContent = '';
    document.getElementById('updateSuccess').textContent = '';
    document.getElementById('submitUpdateBtn').disabled = true;
}

function hideUpdateModal() {
    document.getElementById('updateFileModal').classList.remove('active');
    currentUpdateUrl = null;
}

// Add event listeners for update functionality
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('updateFileInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        const selectedFileElement = document.getElementById('updateSelectedFile');
        const updateBtn = document.getElementById('submitUpdateBtn');
        
        if (file) {
            if (!file.name.endsWith('.html')) {
                selectedFileElement.textContent = 'Only HTML files are allowed';
                updateBtn.disabled = true;
                return;
            }
            selectedFileElement.textContent = `Selected: ${file.name}`;
            updateBtn.disabled = false;
        } else {
            selectedFileElement.textContent = '';
            updateBtn.disabled = true;
        }
    });
    
    if (token) {
        if (isVerified) {
            showApp();
        } else {
            showVerifyEmail();
        }
    } else {
        showAuth();
        switchAuthTab('login');
    }

    document.getElementById('cancelUpdateBtn').addEventListener('click', hideUpdateModal);

    document.getElementById('submitUpdateBtn').addEventListener('click', async function() {
        if (!currentUpdateUrl) return;

        const fileInput = document.getElementById('updateFileInput');
        const errorElement = document.getElementById('updateError');
        const successElement = document.getElementById('updateSuccess');
        const loadingElement = document.getElementById('updateLoading');

        if (!fileInput.files.length) {
            errorElement.textContent = 'Please select a file';
            return;
        }

        const formData = new FormData();
        formData.append('file', fileInput.files[0]);

        try {
            loadingElement.classList.add('active');
            errorElement.textContent = '';
            successElement.textContent = '';

            const response = await fetch(`${BASE_URL}/update/${currentUpdateUrl}`, {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${token}`
                },
                body: formData
            });

            const data = await response.json();

            if (response.ok) {
                successElement.textContent = 'File updated successfully!';
                setTimeout(() => {
                    hideUpdateModal();
                    fetchUserFiles();
                }, 1500);
            } else {
                errorElement.textContent = data.detail || 'Update failed';
            }
        } catch (error) {
            errorElement.textContent = 'An error occurred during update';
        } finally {
            loadingElement.classList.remove('active');
        }
    });
});

document.addEventListener('DOMContentLoaded', function() {
    setupPasswordResetListeners();
    if (token && isVerified) {
        showApp();
        fetchUserInfo();
        fetchUserFiles();
    } else if (token && !isVerified) {
        showVerifyEmail();
    } else {
        showAuth();
        switchAuthTab('login');
    }
    
    setupAuthEventListeners();
    setupAppEventListeners();

});

function setupAuthEventListeners() {
    document.getElementById('loginBtn').addEventListener('click', async function() {
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        
        if (!email || !password) {
            document.getElementById('loginError').textContent = 'Please fill all fields';
            return;
        }
        
        document.getElementById('loginLoading').classList.add('active');
        document.getElementById('loginError').textContent = '';
        
        try {
            const response = await fetch(`${BASE_URL}/token`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `username=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`
            });
            
            const data = await response.json();
            
            if (response.ok) {
                localStorage.setItem('token', data.access_token);
                localStorage.setItem('userId', data.id);
                localStorage.setItem('userEmail', data.email);
                localStorage.setItem('isVerified', data.is_verified);
            
                token = data.access_token;
                userId = data.id;
                userEmail = data.email;
                isVerified = data.is_verified;
            
                if (data.is_verified) {
                    showApp();
                } else {
                    document.getElementById('authContainer').style.display = 'none';
                    document.getElementById('appContainer').style.display = 'none';
                    showVerifyEmail();
                }
            } else {
                document.getElementById('loginError').textContent = data.detail || 'Login failed';
            }
        } catch (error) {
            document.getElementById('loginError').textContent = 'An error occurred. Please try again.';
        } finally {
            document.getElementById('loginLoading').classList.remove('active');
        }
    });

    document.getElementById('registerBtn').addEventListener('click', async function() {
        const email = document.getElementById('registerEmail').value;
        const password = document.getElementById('registerPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        const errorElement = document.getElementById('registerError');
        
        if (!email || !password || !confirmPassword) {
            errorElement.textContent = 'Please fill all fields';
            return;
        }
        
        if (password !== confirmPassword) {
            errorElement.textContent = 'Passwords do not match';
            return;
        }
        
        document.getElementById('registerLoading').classList.add('active');
        
        try {
            const response = await fetch(`${BASE_URL}/register`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    email: email,
                    password: password
                })
            });
            
            // In the register success block
            if (response.ok) {
                const data = await response.json();
                localStorage.setItem('token', data.access_token);
                localStorage.setItem('userId', data.id);
                localStorage.setItem('userEmail', data.email);
                localStorage.setItem('isVerified', 'false');
                
                token = data.access_token;
                userId = data.id;
                userEmail = data.email;
                isVerified = false;
                
                document.getElementById('authContainer').style.display = 'none';
                document.getElementById('appContainer').style.display = 'none';
                showVerifyEmail();
            }
             else {
                const errorData = await response.json();
                errorElement.textContent = errorData.detail || 'Registration failed';
            }
            
        } catch (error) {
            errorElement.textContent = 'An error occurred. Please try again.';
        } finally {
            document.getElementById('registerLoading').classList.remove('active');
        }
    });
}
function setupAppEventListeners() {
    document.getElementById('fileInput').addEventListener('change', function(e) {
        handleFileInputChange(e, 'upload');
    });
    
    document.getElementById('editFileInput').addEventListener('change', function(e) {
        handleFileInputChange(e, 'edit');
    });
    
    document.getElementById('uploadBtn').addEventListener('click', handleFileUpload);
    document.getElementById('updateBtn').addEventListener('click', handleFileUpdate);
    document.getElementById('cancelEditBtn').addEventListener('click', () => switchTab('myFiles'));
    document.getElementById('savePreferences').addEventListener('click', updateDisplayPreferences);
    document.getElementById('forgotPasswordBtn').addEventListener('click', handlePasswordReset);
    document.getElementById('submitResetBtn').addEventListener('click', handleResetSubmit);
}

document.getElementById('fileInput').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const selectedFileElement = document.getElementById('selectedFile');
    const uploadBtn = document.getElementById('uploadBtn');
    
    if (file) {
        if (!file.name.endsWith('.html')) {
            selectedFileElement.textContent = 'Only HTML files are allowed';
            uploadBtn.disabled = true;
            return;
        }
        selectedFileElement.textContent = `Selected: ${file.name}`;
        uploadBtn.disabled = false;
    } else {
        selectedFileElement.textContent = '';
        uploadBtn.disabled = true;
    }
});

document.getElementById('uploadBtn').addEventListener('click', async function() {
    const fileInput = document.getElementById('fileInput');
    const customUrl = document.getElementById('customUrl').value.trim();
    const errorElement = document.getElementById('uploadError');
    const successElement = document.getElementById('uploadSuccess');
    const loadingElement = document.getElementById('uploadLoading');
    
    if (!fileInput.files.length) {
        errorElement.textContent = 'Please select a file';
        return;
    }
    
    const formData = new FormData();
    formData.append('file', fileInput.files[0]);
    
    try {
        loadingElement.classList.add('active');
        errorElement.textContent = '';
        successElement.textContent = '';
        
        let url = `${BASE_URL}/upload`;
        if (customUrl) {
            url += `?custom_url=${encodeURIComponent(customUrl)}`;
        }
        
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            body: formData
        });
        
        const data = await response.json();
        
        if (response.ok) {
            successElement.textContent = `File uploaded successfully! URL: ${FRONTEND_URL}/${data.url}`;
            fileInput.value = '';
            document.getElementById('customUrl').value = '';
            document.getElementById('selectedFile').textContent = '';
            document.getElementById('uploadBtn').disabled = true;
            fetchUserFiles();
        } else {
            errorElement.textContent = data.detail || 'Upload failed';
        }
    } catch (error) {
        errorElement.textContent = 'An error occurred during upload';
    } finally {
        loadingElement.classList.remove('active');
    }
});

function handleNavClick(tab) {
    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
    });
    event.currentTarget.classList.add('active');
    if (tab === 'editor') {
        switchTab('editor');
        initializeEditor();
    }

    switch(tab) {
        case 'profile':
            switchTab('profile');
            break;
        case 'login':
            switchAuthTab('login');
            break;
        case 'register':
            switchAuthTab('register');
            break;
        case 'home':
        case 'upload':
        case 'myFiles':
            switchTab(tab);
            break;
    }
}

function switchTab(tab) {
    // Define all main containers
    const containers = {
        'homeContainer': document.getElementById('homeContainer'),
        'uploadContainer': document.getElementById('uploadContainer'),
        'myFilesContainer': document.getElementById('myFilesContainer'),
        'profileSection': document.getElementById('profileSection'),
        'editorContainer': document.getElementById('editorContainer') // Add this line
    };

    // Hide all containers first
    Object.values(containers).forEach(container => {
        if (container) {
            container.style.display = 'none';
        }
    });

    // Show the selected container
    switch(tab) {
        case 'home':
            containers.homeContainer.style.display = 'block';
            break;
        case 'upload':
            containers.uploadContainer.style.display = 'block';
            break;
        case 'myFiles':
            containers.myFilesContainer.style.display = 'block';
            fetchUserFiles();
            break;
        case 'profile':
            containers.profileSection.style.display = 'block';
            fetchUserInfo();
            break;
        case 'editor':
            containers.editorContainer.style.display = 'block';
            initializeEditor(); // Make sure this is called
            break;
    }

    // Update active state in navigation
    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
    });
    
    const activeNavItem = document.querySelector(`.nav-item[onclick*="${tab}"]`);
    if (activeNavItem) {
        activeNavItem.classList.add('active');
    }
}

function switchAuthTab(tab) {
    document.querySelectorAll('#authContainer > div').forEach(div => {
        div.style.display = 'none';
    });
    
    if (tab === 'login') {
        document.getElementById('loginContainer').style.display = 'block';
    } else if (tab === 'register') {
        document.getElementById('registerContainer').style.display = 'block';
    }
}

function showAuth() {
    document.getElementById('authContainer').style.display = 'block';
    document.getElementById('appContainer').style.display = 'none';
    document.getElementById('auth-nav').style.display = 'block';
    document.getElementById('app-nav').style.display = 'none';
    document.getElementById('verifyEmailContainer').classList.remove('active');
    document.querySelector('.overlay').classList.remove('active');
}

function showApp() {
    document.getElementById('authContainer').style.display = 'none';
    document.getElementById('appContainer').style.display = 'block';
    document.getElementById('auth-nav').style.display = 'none';
    document.getElementById('app-nav').style.display = 'block';
    document.getElementById('verifyEmailContainer').classList.remove('active');
    document.querySelector('.overlay').classList.remove('active');
    showHomeTab();
}

function showVerifyEmail() {
    document.getElementById('authContainer').style.display = 'none';
    document.getElementById('appContainer').style.display = 'none';
    document.getElementById('verifyEmailContainer').classList.add('active');
    document.querySelector('.overlay').classList.add('active');
    
    const verifyEmailText = document.querySelector('#verifyEmailContainer p');
    if (verifyEmailText) {
        verifyEmailText.textContent = `We've sent a verification link to ${userEmail}. Please check your inbox and click the link to verify your account.`;
    }
}

function hideVerifyEmail() {
    document.getElementById('verifyEmailContainer').classList.remove('active');
    document.querySelector('.overlay').classList.remove('active');
    
    if (isVerified) {
        showApp();
    } else if (token) {
        showAuth();
    }
}

async function resendVerificationLink() {
    const errorElement = document.getElementById('verifyError');
    const successElement = document.getElementById('verifySuccess');
    const loadingElement = document.getElementById('verifyLoading');
    
    try {
        loadingElement.classList.add('active');
        errorElement.textContent = '';
        successElement.textContent = '';
        
        const formData = new FormData();
        formData.append('email', userEmail);

        const response = await fetch(`${BASE_URL}/resend-verification`, {
            method: 'POST',
            body: formData
        });
        
        const data = await response.json();
        
        if (response.ok) {
            successElement.textContent = 'Verification email sent! Please check your inbox.';
        } else if (data.detail === "Email already verified") {
            isVerified = true;
            localStorage.setItem('isVerified', 'true');
            hideVerifyEmail();
            showApp();
        } else {
            errorElement.textContent = data.detail || 'Failed to resend verification email';
        }
    } catch (error) {
        errorElement.textContent = 'An error occurred. Please try again.';
    } finally {
        loadingElement.classList.remove('active');
    }
}
function showForgotPassword() {
    document.querySelectorAll('#authContainer > div').forEach(div => {
        div.style.display = 'none';
    });
    
    document.getElementById('resetStep1').style.display = 'block';
    document.getElementById('resetStep2').style.display = 'none';
    document.getElementById('forgotPasswordError').textContent = '';
    document.getElementById('forgotPasswordSuccess').textContent = '';
    document.getElementById('forgotPasswordEmail').value = '';
    document.getElementById('resetCode').value = '';
    document.getElementById('newPassword').value = '';
    document.getElementById('confirmNewPassword').value = '';
    
    document.getElementById('forgotPasswordContainer').style.display = 'block';
}

async function handlePasswordReset() {
    const email = document.getElementById('forgotPasswordEmail').value;
    const errorElement = document.getElementById('forgotPasswordError');
    const successElement = document.getElementById('forgotPasswordSuccess');
    const loadingElement = document.getElementById('forgotPasswordLoading');
    
    if (!email) {
        errorElement.textContent = 'Please enter your email';
        return;
    }

    try {
        loadingElement.classList.add('active');
        errorElement.textContent = '';
        successElement.textContent = '';

        const formData = new FormData();
        formData.append('email', email);

        const response = await fetch(`${BASE_URL}/request-password-reset`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email: email })
        });

        const data = await response.json();

        if (response.ok) {
            successElement.textContent = 'Reset code sent to your email!';
            document.getElementById('resetStep1').style.display = 'none';
            document.getElementById('resetStep2').style.display = 'block';
        } else {
            errorElement.textContent = data.detail || 'Failed to send reset code';
        }
    } catch (error) {
        errorElement.textContent = 'An error occurred. Please try again.';
        console.error('Password reset error:', error);
    } finally {
        loadingElement.classList.remove('active');
    }
}

async function handleResetSubmit() {
    const email = document.getElementById('forgotPasswordEmail').value;
    const code = document.getElementById('resetCode').value;
    const newPassword = document.getElementById('newPassword').value;
    const confirmPassword = document.getElementById('confirmNewPassword').value;
    const errorElement = document.getElementById('forgotPasswordError');
    const successElement = document.getElementById('forgotPasswordSuccess');
    const loadingElement = document.getElementById('forgotPasswordLoading');
    
    if (!code || !newPassword || !confirmPassword) {
        errorElement.textContent = 'Please fill all fields';
        return;
    }

    if (newPassword !== confirmPassword) {
        errorElement.textContent = 'Passwords do not match';
        return;
    }

    try {
        loadingElement.classList.add('active');
        errorElement.textContent = '';
        successElement.textContent = '';

        const response = await fetch(`${BASE_URL}/reset-password`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                email,
                reset_code: code,
                new_password: newPassword
            })
        });

        const data = await response.json();

        if (response.ok) {
            successElement.textContent = 'Password reset successfully!';
            setTimeout(() => {
                switchAuthTab('login');
            }, 2000);
        } else {
            errorElement.textContent = data.detail || 'Failed to reset password';
        }
    } catch (error) {
        errorElement.textContent = 'An error occurred. Please try again.';
        console.error('Reset submit error:', error);
    } finally {
        loadingElement.classList.remove('active');
    }
}

function setupPasswordResetListeners() {
    const forgotPasswordBtn = document.getElementById('forgotPasswordBtn');
    const submitResetBtn = document.getElementById('submitResetBtn');
    
    if (forgotPasswordBtn) {
        forgotPasswordBtn.addEventListener('click', handlePasswordReset);
    }
    
    if (submitResetBtn) {
        submitResetBtn.addEventListener('click', handleResetSubmit);
    }
}
async function handleRegistrationSuccess(data) {
    localStorage.setItem('token', data.access_token);
    localStorage.setItem('userId', data.id);
    localStorage.setItem('userEmail', data.email);
    localStorage.setItem('isVerified', 'false');

    token = data.access_token;
    userId = data.id;
    userEmail = data.email;
    isVerified = false;

    showVerifyEmail();
}

function handleFileInputChange(e, type) {
    const isUpload = type === 'upload';
    const file = e.target.files[0];
    const errorElement = document.getElementById(isUpload ? 'uploadError' : 'editError');
    const selectedFileElement = document.getElementById(isUpload ? 'selectedFile' : 'editSelectedFile');
    const actionButton = document.getElementById(isUpload ? 'uploadBtn' : 'updateBtn');
    
    if (file) {
        if (!file.name.endsWith('.html')) {
            errorElement.textContent = 'Only HTML files are allowed';
            actionButton.disabled = true;
            selectedFileElement.textContent = '';
            return;
        }
        selectedFileElement.textContent = `Selected: ${file.name}`;
        actionButton.disabled = false;
        errorElement.textContent = '';
    } else {
        selectedFileElement.textContent = '';
        actionButton.disabled = true;
    }
}

async function handleFileUpload() {
    const fileInput = document.getElementById('fileInput');
    const customUrlInput = document.getElementById('customUrl');
    const customUrl = customUrlInput.value.trim();
    
    if (!fileInput.files.length) {
        document.getElementById('uploadError').textContent = 'Please select a file';
        return;
    }
    
    document.getElementById('uploadLoading').classList.add('active');
    document.getElementById('uploadError').textContent = '';
    document.getElementById('uploadSuccess').textContent = '';
    document.getElementById('uploadBtn').disabled = true;
    
    try {
        let uploadUrl = `${BASE_URL}/upload`;
        if (customUrl) {
            uploadUrl += `?custom_url=${encodeURIComponent(customUrl)}`;
        }
        
        const formData = new FormData();
        formData.append('file', fileInput.files[0]);
        
        const response = await fetch(uploadUrl, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            body: formData
        });
        
        if (!response.ok) {
            throw new Error(`Upload failed: ${response.status}`);
        }
        
        const data = await response.json();
        document.getElementById('uploadSuccess').textContent = 
            `File uploaded successfully! Access your file at: ${FRONTEND_URL}/${data.url}`;
        
        fileInput.value = '';
        customUrlInput.value = '';
        document.getElementById('selectedFile').textContent = '';
        
        fetchUserInfo();
        fetchUserFiles();
        
    } catch (error) {
        console.error('Upload error:', error);
        document.getElementById('uploadError').textContent = error.message || 'An error occurred during upload. Please try again.';
    } finally {
        document.getElementById('uploadLoading').classList.remove('active');
        document.getElementById('uploadBtn').disabled = false;
    }
}

async function handleFileUpdate() {
    if (!currentUrl) {
        document.getElementById('editError').textContent = 'No file selected for update';
        return;
    }
    
    const fileInput = document.getElementById('editFileInput');
    if (!fileInput.files.length) {
        document.getElementById('editError').textContent = 'Please select a file';
        return;
    }
    
    document.getElementById('editLoading').classList.add('active');
    document.getElementById('editError').textContent = '';
    document.getElementById('editSuccess').textContent = '';
    
    const formData = new FormData();
    formData.append('file', fileInput.files[0]);
    
    try {
        const response = await fetch(`${BASE_URL}/update/${currentUrl}`, {
            method: 'PUT',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            body: formData
        });
        
        const data = await response.json();
        
        if (response.ok) {
            document.getElementById('editSuccess').textContent = 'File updated successfully!';
            document.getElementById('editSelectedFile').textContent = '';
            document.getElementById('editFileInput').value = '';
            document.getElementById('updateBtn').disabled = true;
            
            setTimeout(() => {
                switchTab('myFiles');
            }, 1500);
        } else {
            document.getElementById('editError').textContent = data.detail || 'Update failed';
        }
    } catch (error) {
        document.getElementById('editError').textContent = 'An error occurred. Please try again.';
    }
    
    document.getElementById('editLoading').classList.remove('active');
}

async function deleteFile(url) {
    try {
        const response = await fetch(`${BASE_URL}/file/${url}`, {
            method: 'DELETE',
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        
        if (response.ok) {
            fetchUserFiles();
            fetchUserInfo();
        } else {
            alert('Failed to delete file');
        }
    } catch (error) {
        alert('An error occurred. Please try again.');
    }
}

async function fetchUserInfo() {
    try {
        const response = await fetch(`${BASE_URL}/me`, {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });

        if (response.ok) {
            const data = await response.json();
            
            document.getElementById('profileEmail').textContent = data.email;
            document.getElementById('profileUserId').textContent = data.user_number ? `#${data.user_number}` : 'N/A';
            document.getElementById('profileUrlCount').textContent = `${data.url_count}/10`;

            // Update preferences checkboxes
            const preferences = data.display_preferences || {};
            document.getElementById('showViews').checked = preferences.show_views ?? true;
            document.getElementById('showUuid').checked = preferences.show_uuid ?? true;
            document.getElementById('showTags').checked = preferences.show_tags ?? true;

            // Update tags display
            const tagsContainer = document.getElementById('profileTags');
            tagsContainer.innerHTML = data.tags?.length ? 
                data.tags.map(tag => `
                    <div class="tag">
                        ${processTagIcon(tag.icon)}
                        <span>${tag.text}</span>
                    </div>
                `).join('') : 
                '<div class="tag">No tags yet</div>';
        } else {
            if (response.status === 401) {
                logout();
            }
        }
    } catch (error) {
        console.error('Failed to fetch user info:', error);
    }
}

// Add event listener for the save preferences button
document.addEventListener('DOMContentLoaded', function() {
    const savePreferencesBtn = document.getElementById('savePreferences');
    if (savePreferencesBtn) {
        savePreferencesBtn.addEventListener('click', updateDisplayPreferences);
    }
});

async function fetchUserFiles() {
    try {
        const response = await fetch(`${BASE_URL}/my-files`, {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });

        if (response.ok) {
            const files = await response.json();
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = files.length ? files.map(file => `
                <div class="file-item">
                    <div class="file-info">
                        <div class="file-name">${file.filename}</div>
                        <div class="file-url">
                            <a href="${FRONTEND_URL}/${file.url}" target="_blank">
                                ${FRONTEND_URL}/${file.url} 👁️
                            </a>
                        </div>
                        <div class="file-stats">Views: ${file.views}</div>
                        <div class="file-dates">
                            Created: ${new Date(file.created_at).toLocaleDateString()}
                            ${file.updated_at ? `<br>Updated: ${new Date(file.updated_at).toLocaleDateString()}` : ''}
                        </div>
                    </div>
                    <div class="file-actions">
                        <button class="file-action" onclick="showUpdateFile('${file.url}')" title="Update">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="file-action" onclick="deleteFile('${file.url}')" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('') : '<div class="no-files">No files uploaded yet</div>';
        }
    } catch (error) {
        console.error('Error fetching files:', error);
    }
}

async function copyToClipboard(text) {
    try {
        await navigator.clipboard.writeText(text);
        alert('URL copied to clipboard!');
    } catch (err) {
        console.error('Failed to copy:', err);
    }
}


async function updateDisplayPreferences() {
    const showViews = document.getElementById('showViews').checked;
    const showUuid = document.getElementById('showUuid').checked;
    const showTags = document.getElementById('showTags').checked;

    try {
        const response = await fetch(`${BASE_URL}/preferences`, {
            method: 'PUT',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                show_views: showViews,
                show_uuid: showUuid,
                show_tags: showTags
            })
        });

        if (response.ok) {
            // Add visual feedback
            const btn = document.getElementById('savePreferences');
            const originalText = btn.textContent;
            btn.textContent = 'Saved!';
            btn.style.backgroundColor = 'var(--accent-color)';
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.backgroundColor = '';
            }, 2000);
            
            // Refresh user info to get updated preferences
            await fetchUserInfo();
        } else {
            const data = await response.json();
            alert(data.detail || 'Failed to update preferences');
        }
    } catch (error) {
        console.error('Error updating preferences:', error);
        alert('An error occurred while updating preferences');
    }
}

function processTagIcon(icon) {
    if (isImageUrl(icon)) {
        return `<img src="${icon}" alt="tag icon" style="width: 16px; height: 16px; vertical-align: middle;">`;
    }
    if (isSvgCode(icon)) {
        const viewBoxMatch = icon.match(/viewBox=["']([^"']+)["']/);
        const viewBox = viewBoxMatch ? viewBoxMatch[1] : "0 0 24 24";
        return icon.replace('<svg', `<svg style="width: 16px; height: 16px; vertical-align: middle;" viewBox="${viewBox}"`);
    }
    return icon;
}

function isImageUrl(str) {
    return str.match(/\.(jpg|jpeg|png|gif|svg)$/i) || 
           str.startsWith('data:image/') || 
           str.startsWith('http') && str.match(/\.(jpg|jpeg|png|gif|svg)/i);
}

function isSvgCode(str) {
    return str.trim().startsWith('<svg') && str.includes('</svg>');
}

function logout() {
    localStorage.removeItem('token');
    localStorage.removeItem('userId');
    localStorage.removeItem('userEmail');
    localStorage.removeItem('isVerified');
    token = null;
    userId = null;
    userEmail = null;
    isVerified = false;
    
    document.getElementById('loginEmail').value = '';
    document.getElementById('loginPassword').value = '';
    document.getElementById('registerEmail').value = '';
    document.getElementById('registerPassword').value = '';
    document.getElementById('confirmPassword').value = '';
    
    hideVerifyEmail();
    showAuth();
    switchAuthTab('login');
}

function handleLogout() {
    localStorage.removeItem('token');
    localStorage.removeItem('userId');
    localStorage.removeItem('userEmail');
    localStorage.removeItem('isVerified');
    window.location.reload();
}
async function handleLoginSuccess(data) {
    localStorage.setItem('token', data.access_token);
    localStorage.setItem('userId', data.id);
    localStorage.setItem('userEmail', data.email);
    localStorage.setItem('isVerified', data.is_verified);

    token = data.access_token;
    userId = data.id;
    userEmail = data.email;
    isVerified = data.is_verified;

    if (isVerified) {
        showApp();
    } else {
        showVerifyEmail();
    }
}

function showHomeTab() {
    switchTab('home');
}
    </script>
    </body>
</html>
